<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Recipes & Meal Planning</title>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA2hOiQV4oiMf8YGlXMsK7vMbsdWonAsYE",
    authDomain: "meal-recipe-b7753.firebaseapp.com",
    projectId: "meal-recipe-b7753",
    storageBucket: "meal-recipe-b7753.firebasestorage.app",
    messagingSenderId: "775365507411",
    appId: "1:775365507411:web:eb8406b1d1b27dd6c609a6"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
</script>

<style>
  body { margin:0; font-family:'Segoe UI',sans-serif; background:#e6f4f1; color:#333; }
  nav { background:#14532d; display:flex; flex-wrap:wrap; justify-content:center; padding:12px 0; }
  nav a { color:white; margin:5px 15px; text-decoration:none; font-weight:bold; }
  nav a.active { text-decoration:underline; }
  .container { max-width:1000px; margin:20px auto; padding:20px; background:white; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
  h1, h2 { text-align:center; color:#14532d; }
  .hidden { display:none; }
  input, textarea { width:100%; padding:10px; margin-top:5px; border:1px solid #ccc; border-radius:6px; }
  button { background:#16a34a; color:white; border:none; padding:10px 16px; border-radius:6px; cursor:pointer; margin-top:10px; }
  button:hover { background:#15803d; }
  ul { list-style:none; padding:0; }
  li { background:#e6f4ea; border-radius:8px; margin-bottom:8px; padding:10px; display:flex; justify-content:space-between; align-items:center; }
  .card { background:#f0fdf4; padding:8px; border-radius:8px; margin:6px 0; cursor:pointer; }
  .calendar { display:grid; grid-template-columns:repeat(7,1fr); gap:8px; margin-top:20px; }
  .day { background:#d1fae5; border-radius:8px; min-height:140px; padding:8px; }
  .day h4 { text-align:center; background:#14532d; color:white; border-radius:4px; padding:4px; margin-top:0; }
  .draggable { background:#4ade80; color:white; border-radius:6px; padding:5px; margin-top:5px; cursor:grab; }
  #recipe-modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
  #modal-content { background:white; border-radius:12px; padding:20px; max-width:600px; width:90%; max-height:80vh; overflow-y:auto; }
  #modal-content h3 { color:#14532d; margin-top:0; }
  #close-modal { background:#ef4444; margin-top:10px; }
  .hero { background:url('https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=1350&q=80') center/cover no-repeat; height:300px; border-radius:12px; margin-bottom:20px; display:flex; align-items:center; justify-content:center; color:white; text-shadow:2px 2px 4px rgba(0,0,0,0.5); }
  .hero h1 { font-size:2.5em; }
  @media(max-width:768px){ .calendar { grid-template-columns:repeat(2,1fr); } }
  @media(max-width:480px){ .calendar { grid-template-columns:1fr; } nav { flex-direction:column; } }
</style>
</head>
<body>

<nav>
  <a href="#" id="nav-home" onclick="showSection('home')">Home</a>
  <a href="#" id="nav-add" onclick="showSection('add')">Add Recipe</a>
  <a href="#" id="nav-book" onclick="showSection('book')">Recipe Book</a>
  <a href="#" id="nav-meal" onclick="showSection('meal')">Meal Planner</a>
</nav>

<div class="container">

  <!-- Home -->
  <section id="home-section">
    <div class="hero">
      <h1>Recipes & Meal Planning</h1>
    </div>
    <p style="text-align:center;">Organize, save, and plan your meals for the week with beautiful recipes and fine cuisine images.</p>
  </section>

  <!-- Add Recipe -->
  <section id="add-section" class="hidden">
    <h2>Add Recipe</h2>
    <form id="add-form">
      <label>Title</label>
      <input type="text" id="add-title" required>
      <label>Ingredients (one per line)</label>
      <textarea id="add-ingredients" rows="4" required></textarea>
      <label>Instructions</label>
      <textarea id="add-instructions" rows="5" required></textarea>
      <label>Upload Image</label>
      <input type="file" id="add-image" accept="image/*">
      <button type="submit">Add Recipe</button>
    </form>
  </section>

  <!-- Recipe Book -->
  <section id="book-section" class="hidden">
    <h2>Recipe Book</h2>
    <ul id="recipe-list"></ul>
    <div id="no-recipes" style="text-align:center;color:#777;">No recipes yet. Add one!</div>
  </section>

  <!-- Meal Planner -->
  <section id="meal-section" class="hidden">
    <h2>Weekly Meal Planner</h2>
    <p style="text-align:center;">Drag recipes into each day. Double-click to remove.</p>
    <div class="calendar" id="calendar">
      <div class="day" data-day="Monday"><h4>Monday</h4></div>
      <div class="day" data-day="Tuesday"><h4>Tuesday</h4></div>
      <div class="day" data-day="Wednesday"><h4>Wednesday</h4></div>
      <div class="day" data-day="Thursday"><h4>Thursday</h4></div>
      <div class="day" data-day="Friday"><h4>Friday</h4></div>
      <div class="day" data-day="Saturday"><h4>Saturday</h4></div>
      <div class="day" data-day="Sunday"><h4>Sunday</h4></div>
    </div>
    <h3 style="margin-top:30px;">Your Recipes</h3>
    <div id="recipe-pool"></div>
    <button onclick="clearCalendar()">Clear Calendar</button>
  </section>

</div>

<!-- Modal -->
<div id="recipe-modal">
  <div id="modal-content">
    <h3 id="modal-title"></h3>
    <h4>Ingredients</h4>
    <ul id="modal-ingredients"></ul>
    <h4>Instructions</h4>
    <p id="modal-instructions"></p>
    <button id="close-modal">Close</button>
  </div>
</div>

<script>
let recipes = [];
let mealPlan = {};

function loadData() {
  recipes = JSON.parse(localStorage.getItem('recipes')) || [];
  mealPlan = JSON.parse(localStorage.getItem('mealPlan')) || {};
}
function saveRecipes() { localStorage.setItem('recipes', JSON.stringify(recipes)); }
function saveMealPlan() { localStorage.setItem('mealPlan', JSON.stringify(mealPlan)); }

function showSection(name){
  ['home','add','book','meal'].forEach(s=>{
    document.getElementById(s+'-section').classList.add('hidden');
    document.getElementById('nav-'+s)?.classList.remove('active');
  });
  document.getElementById(name+'-section').classList.remove('hidden');
  document.getElementById('nav-'+name)?.classList.add('active');
  if(name==='book') renderBook();
  if(name==='meal') renderMealPlanner();
}

document.getElementById('add-form').addEventListener('submit', e=>{
  e.preventDefault();
  const title=document.getElementById('add-title').value.trim();
  const ingredients=document.getElementById('add-ingredients').value.trim();
  const instructions=document.getElementById('add-instructions').value.trim();
  const image=document.getElementById('add-image').files[0];
  let reader = null;
  if(image){
    reader = new FileReader();
    reader.onload = function(ev){
      const newRecipe={id:Date.now(),title,ingredients,instructions,image:ev.target.result};
      recipes.push(newRecipe);
      saveRecipes();
      e.target.reset();
      alert("Recipe added!");
      showSection('book');
    };
    reader.readAsDataURL(image);
  } else {
    const newRecipe={id:Date.now(),title,ingredients,instructions};
    recipes.push(newRecipe);
    saveRecipes();
    e.target.reset();
    alert("Recipe added!");
    showSection('book');
  }
});

function renderBook(){
  loadData();
  const list=document.getElementById('recipe-list');
  list.innerHTML='';
  if(recipes.length===0){
    document.getElementById('no-recipes').style.display='block';
    return;
  }
  document.getElementById('no-recipes').style.display='none';
  recipes.forEach(r=>{
    const li=document.createElement('li');
    li.innerHTML=`<span style="cursor:pointer;font-weight:bold;" onclick="openRecipe(${r.id})">${r.title}</span>
      <button onclick="deleteRecipe(${r.id})">Delete</button>`;
    list.appendChild(li);
  });
}

function deleteRecipe(id){
  if(confirm("Delete this recipe?")){
    recipes=recipes.filter(r=>r.id!==id);
    saveRecipes();
    renderBook();
    Object.keys(mealPlan).forEach(day=>{ mealPlan[day]=mealPlan[day].filter(i=>i!==id); });
    saveMealPlan();
  }
}

function openRecipe(id){
  const r=recipes.find(x=>x.id===id);
  if(!r) return;
  document.getElementById('modal-title').textContent=r.title;
  document.getElementById('modal-ingredients').innerHTML=r.ingredients.split('\n').map(i=>`<li>${i}</li>`).join('');
  document.getElementById('modal-instructions').textContent=r.instructions;
  if(r.image){
    const img=document.createElement('img'); img.src=r.image; img.style.width="100%"; img.style.borderRadius="8px"; 
    document.getElementById('modal-content').insertBefore(img, document.getElementById('modal-title').nextSibling);
  }
  document.getElementById('recipe-modal').style.display='flex';
}
document.getElementById('close-modal').onclick=()=>document.getElementById('recipe-modal').style.display='none';
window.onclick=(e)=>{if(e.target.id==='recipe-modal')document.getElementById('recipe-modal').style.display='none';};

function renderMealPlanner(){
  loadData();
  const pool=document.getElementById('recipe-pool');
  pool.innerHTML='';
  if(recipes.length===0){ pool.innerHTML="<p>No recipes yet.</p>"; }
  else {
    recipes.forEach(r=>{
      const div=document.createElement('div');
      div.className='draggable';
      div.textContent=r.title;
      div.draggable=true;
      div.dataset.id=r.id;
      div.addEventListener('dragstart', handleDragStart);
      pool.appendChild(div);
    });
  }

  document.querySelectorAll('.day').forEach(day=>{
    day.innerHTML=`<h4>${day.dataset.day}</h4>`;
    const meals=mealPlan[day.dataset.day]||[];
    meals.forEach(rid=>{
      const recipe=recipes.find(r=>r.id==rid);
      if(recipe){
        const card=document.createElement('div');
        card.className='card';
        card.textContent=recipe.title;
        card.ondblclick=(e)=>{ removeMeal(day.dataset.day,rid); };
        day.appendChild(card);
      }
    });
    day.addEventListener('dragover', e=>e.preventDefault());
    day.addEventListener('drop', handleDrop);
  });
}

function handleDragStart(e){ e.dataTransfer.setData('text/plain', e.target.dataset.id); }
function handleDrop(e){
  const rid=parseInt(e.dataTransfer.getData('text/plain'));
  const day=e.currentTarget.dataset.day;
  if(!mealPlan[day]) mealPlan[day]=[];
  mealPlan[day].push(rid);
  saveMealPlan();
  renderMealPlanner();
}
function removeMeal(day,rid){ mealPlan[day]=mealPlan[day].filter(i=>i!==rid); saveMealPlan(); renderMealPlanner(); }
function clearCalendar(){ if(confirm("Clear all meals?")){ mealPlan={}; saveMealPlan(); renderMealPlanner(); } }

loadData();
showSection('home');
</script>
</body>
</html>
